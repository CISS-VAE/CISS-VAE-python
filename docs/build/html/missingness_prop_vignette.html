

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Using create_missingness_prop_matrix: A Complete Guide &mdash; CISS-VAE 1.0.18 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css?v=6644e6bb" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/styles.css" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=14ed45bf"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=00122899"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Avoiding undesired imputation of certain missing data" href="dni_vignette.html" />
    <link rel="prev" title="Handling binary data columns" href="binary_vignette.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            CISS-VAE
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">CISS-VAE Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html#quickstart">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette.html">How to use CISS-VAE</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette.html#installation">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette.html#running-the-ciss-vae-model">Running the CISS-VAE Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette.html#hyperparameter-tuning-with-optuna">Hyperparameter Tuning with Optuna</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette.html#creating-a-clusterdataset-object">Creating a <code class="docutils literal notranslate"><span class="pre">ClusterDataset</span></code> object</a></li>
<li class="toctree-l1"><a class="reference internal" href="vignette.html#saving-and-loading-models">Saving and loading models</a></li>
<li class="toctree-l1"><a class="reference internal" href="binary_vignette.html">Handling binary data columns</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Using <code class="docutils literal notranslate"><span class="pre">create_missingness_prop_matrix</span></code>: A Complete Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#data-format-support">Data Format Support</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#wide-format-default">1. <strong>Wide Format</strong> (default)</a></li>
<li class="toctree-l3"><a class="reference internal" href="#long-format">2. <strong>Long Format</strong></a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#wide-format-examples">Wide Format Examples</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example-1-basic-wide-format-with-regex-parsing">Example 1: Basic Wide Format with Regex Parsing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-2-custom-regex-pattern">Example 2: Custom Regex Pattern</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-3-explicit-column-mapping">Example 3: Explicit Column Mapping</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#integration-with-sample-clustering">Integration with sample clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="#integration-w-ciss-vae-pipeline">Integration w/ CISS-VAE pipeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="#full-workflow">Full workflow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#extra-tips">Extra tips</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="dni_vignette.html">Avoiding undesired imputation of certain missing data</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">CISS-VAE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Using <code class="docutils literal notranslate"><span class="pre">create_missingness_prop_matrix</span></code>: A Complete Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/missingness_prop_vignette.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">capture</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">warnings</span><span class="o">,</span><span class="w"> </span><span class="nn">sys</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
<span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/dev/null&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="using-create-missingness-prop-matrix-a-complete-guide">
<h1>Using <code class="docutils literal notranslate"><span class="pre">create_missingness_prop_matrix</span></code>: A Complete Guide<a class="headerlink" href="#using-create-missingness-prop-matrix-a-complete-guide" title="Link to this heading"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">create_missingness_prop_matrix()</span></code> function creates a matrix showing the proportion of missing values for each sample–feature combination across multiple timepoints. This matrix can then be used for <strong>sample clustering</strong> with <code class="docutils literal notranslate"><span class="pre">cluster_on_missing_prop()</span></code> or as input to the complete CISS-VAE pipeline via <code class="docutils literal notranslate"><span class="pre">run_cissvae()</span></code>.</p>
<section id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Link to this heading"></a></h2>
<p>The function returns a <strong>n_samples × n_features</strong> matrix where each cell contains a value between 0 and 1 representing:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">proportion</span> <span class="o">=</span> <span class="p">(</span><span class="n">number</span> <span class="n">of</span> <span class="n">missing</span> <span class="n">timepoints</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">total</span> <span class="n">timepoints</span><span class="p">)</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>0.0</strong> = no missing values for that sample-feature combination</p></li>
<li><p><strong>1.0</strong> = all timepoints missing for that sample-feature combination</p></li>
</ul>
</section>
<section id="data-format-support">
<h2>Data Format Support<a class="headerlink" href="#data-format-support" title="Link to this heading"></a></h2>
<p>The function supports two input formats:</p>
<section id="wide-format-default">
<h3>1. <strong>Wide Format</strong> (default)<a class="headerlink" href="#wide-format-default" title="Link to this heading"></a></h3>
<p>Columns represent feature×timepoint combinations, rows represent samples.</p>
</section>
<section id="long-format">
<h3>2. <strong>Long Format</strong><a class="headerlink" href="#long-format" title="Link to this heading"></a></h3>
<p>Each row represents one sample/feature/timepoint observation.</p>
</section>
</section>
<hr class="docutils" />
<section id="wide-format-examples">
<h2>Wide Format Examples<a class="headerlink" href="#wide-format-examples" title="Link to this heading"></a></h2>
<section id="example-1-basic-wide-format-with-regex-parsing">
<h3>Example 1: Basic Wide Format with Regex Parsing<a class="headerlink" href="#example-1-basic-wide-format-with-regex-parsing" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ciss_vae.utils.matrix</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_missingness_prop_matrix</span>

<span class="c1"># Create sample wide-format data</span>
<span class="c1"># Columns follow pattern: feature_timepoint</span>
<span class="n">data_wide</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sample_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;mouse1&#39;</span><span class="p">,</span> <span class="s1">&#39;mouse2&#39;</span><span class="p">,</span> <span class="s1">&#39;mouse3&#39;</span><span class="p">],</span>
    <span class="s1">&#39;glucose_t0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">95</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
    <span class="s1">&#39;glucose_t1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">110</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">105</span><span class="p">],</span>
    <span class="s1">&#39;glucose_t2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">115</span><span class="p">],</span>
    <span class="s1">&#39;insulin_t0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.2</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span>
    <span class="s1">&#39;insulin_t1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">],</span>
    <span class="s1">&#39;insulin_t2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">6.0</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
<span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Data: </span><span class="se">\n</span><span class="si">{</span><span class="n">data_wide</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Basic usage - regex automatically extracts features</span>
<span class="n">prop_matrix</span> <span class="o">=</span> <span class="n">create_missingness_prop_matrix</span><span class="p">(</span>
    <span class="n">data_wide</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span><span class="p">,</span>
    <span class="n">repeat_feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;glucose&quot;</span><span class="p">,</span> <span class="s2">&quot;insulin&quot;</span><span class="p">],</span>
    <span class="n">timepoint_prefix</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output: </span><span class="se">\n</span><span class="si">{</span><span class="n">prop_matrix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Data: 
  sample_id  glucose_t0  glucose_t1  glucose_t2  insulin_t0  insulin_t1  \
0    mouse1       100.0       110.0         NaN         5.2         NaN   
1    mouse2        95.0         NaN       100.0         4.8         NaN   
2    mouse3         NaN       105.0       115.0         5.0         5.5   

   insulin_t2  
0         6.0  
1         5.1  
2         NaN  


Output: 
         glucose   insulin
mouse1  0.333333  0.333333
mouse2  0.333333  0.333333
mouse3  0.333333  0.333333
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-2-custom-regex-pattern">
<h3>Example 2: Custom Regex Pattern<a class="headerlink" href="#example-2-custom-regex-pattern" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data with different naming convention: feature.timepoint</span>
<span class="n">data_custom</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;ID&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
    <span class="s1">&#39;weight_day1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">25.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">27.0</span><span class="p">],</span>
    <span class="s1">&#39;weight_day7&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">24.5</span><span class="p">,</span> <span class="mf">26.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
    <span class="s1">&#39;height_day1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">9.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
    <span class="s1">&#39;height_day7&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">10.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mf">9.8</span><span class="p">]</span>
<span class="p">})</span>

<span class="n">prop_matrix</span> <span class="o">=</span> <span class="n">create_missingness_prop_matrix</span><span class="p">(</span>
    <span class="n">data_custom</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;ID&quot;</span><span class="p">,</span>
    <span class="n">repeat_feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;weight&quot;</span><span class="p">,</span> <span class="s2">&quot;height&quot;</span><span class="p">],</span>
    <span class="n">timepoint_prefix</span> <span class="o">=</span> <span class="s2">&quot;day&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output: </span><span class="se">\n</span><span class="si">{</span><span class="n">prop_matrix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Output: 
   weight  height
A     0.0     0.0
B     0.5     0.5
C     0.5     0.5
</pre></div>
</div>
</div>
</div>
</section>
<section id="example-3-explicit-column-mapping">
<h3>Example 3: Explicit Column Mapping<a class="headerlink" href="#example-3-explicit-column-mapping" title="Link to this heading"></a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">data_mixed</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;subject&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;S1&#39;</span><span class="p">,</span> <span class="s1">&#39;S2&#39;</span><span class="p">],</span>
    <span class="s1">&#39;baseline_glucose&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">],</span>
    <span class="s1">&#39;followup_glucose&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">95</span><span class="p">,</span> <span class="mi">88</span><span class="p">],</span>
    <span class="s1">&#39;glucose_final&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">92</span><span class="p">],</span>
    <span class="s1">&#39;insulin_start&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">],</span>
    <span class="s1">&#39;insulin_end&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">]</span>
<span class="p">})</span>

<span class="c1"># Explicitly map columns to features</span>
<span class="n">column_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;glucose&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baseline_glucose&quot;</span><span class="p">,</span> <span class="s2">&quot;followup_glucose&quot;</span><span class="p">,</span> <span class="s2">&quot;glucose_final&quot;</span> <span class="p">],</span>
    <span class="s2">&quot;insulin&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;insulin_start&quot;</span><span class="p">,</span> <span class="s2">&quot;insulin_end&quot;</span><span class="p">]</span>
<span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data_mixed</span><span class="p">)</span>

<span class="n">prop_matrix</span> <span class="o">=</span> <span class="n">create_missingness_prop_matrix</span><span class="p">(</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">data_mixed</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;subject&quot;</span><span class="p">,</span>
    <span class="n">column_mapping</span><span class="o">=</span><span class="n">column_mapping</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Output: </span><span class="se">\n</span><span class="si">{</span><span class="n">prop_matrix</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  subject  baseline_glucose  followup_glucose  glucose_final  insulin_start  insulin_end
0      S1              90.0                95            NaN            4.0          4.5
1      S2               NaN                88           92.0            3.8          NaN
Output: 
     glucose  insulin
S1  0.333333      0.0
S2  0.333333      0.5
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="integration-with-sample-clustering">
<h1>Integration with sample clustering<a class="headerlink" href="#integration-with-sample-clustering" title="Link to this heading"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ciss_vae.utils.clustering</span><span class="w"> </span><span class="kn">import</span> <span class="n">cluster_on_missing_prop</span>

<span class="n">data_wide</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;sample_id&#39;</span><span class="p">:</span>  <span class="p">[</span><span class="s1">&#39;mouse1&#39;</span><span class="p">,</span> <span class="s1">&#39;mouse2&#39;</span><span class="p">,</span> <span class="s1">&#39;mouse3&#39;</span><span class="p">,</span> <span class="s1">&#39;mouse4&#39;</span><span class="p">,</span> <span class="s1">&#39;mouse5&#39;</span><span class="p">],</span>
    <span class="s1">&#39;glucose_t0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span>      <span class="mi">95</span><span class="p">,</span>       <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>   <span class="mi">102</span><span class="p">,</span>      <span class="mi">98</span>     <span class="p">],</span>
    <span class="s1">&#39;glucose_t1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">110</span><span class="p">,</span>      <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>   <span class="mi">105</span><span class="p">,</span>      <span class="mi">108</span><span class="p">,</span>      <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="p">],</span>
    <span class="s1">&#39;glucose_t2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">115</span><span class="p">,</span>      <span class="mi">100</span><span class="p">,</span>      <span class="mi">107</span><span class="p">,</span>   <span class="mi">118</span><span class="p">,</span>   <span class="mi">112</span>    <span class="p">],</span>
    <span class="s1">&#39;insulin_t0&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">5.2</span><span class="p">,</span>      <span class="mf">4.8</span><span class="p">,</span>      <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>      <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>   <span class="mf">5.1</span>    <span class="p">],</span>
    <span class="s1">&#39;insulin_t1&#39;</span><span class="p">:</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>   <span class="mf">5.5</span><span class="p">,</span>      <span class="mf">5.3</span><span class="p">,</span>      <span class="mf">5.4</span>    <span class="p">],</span>
    <span class="s1">&#39;insulin_t2&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">6.0</span><span class="p">,</span>      <span class="mf">5.1</span><span class="p">,</span>      <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>   <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>      <span class="n">np</span><span class="o">.</span><span class="n">nan</span> <span class="p">],</span>
<span class="p">})</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data_wide</span><span class="p">)</span>

<span class="c1"># Create missingness proportion matrix</span>
<span class="n">prop_matrix</span> <span class="o">=</span> <span class="n">create_missingness_prop_matrix</span><span class="p">(</span>
    <span class="n">data_wide</span><span class="p">,</span> 
    <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">prop_matrix</span><span class="p">)</span>

<span class="c1"># Cluster samples based on similar missingness patterns across features</span>
<span class="n">clusters</span><span class="p">,</span> <span class="n">silhouette</span> <span class="o">=</span> <span class="n">cluster_on_missing_prop</span><span class="p">(</span>
    <span class="n">prop_matrix</span><span class="p">,</span>
    <span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;cosine&quot;</span><span class="p">,</span>
    <span class="n">scale_features</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Clusters:&quot;</span><span class="p">,</span> <span class="n">clusters</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Silhouette score:&quot;</span><span class="p">,</span> <span class="n">silhouette</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  sample_id  glucose_t0  glucose_t1  glucose_t2  insulin_t0  insulin_t1  insulin_t2
0    mouse1       100.0       110.0         115         5.2         NaN         6.0
1    mouse2        95.0         NaN         100         4.8         NaN         5.1
2    mouse3         NaN       105.0         107         NaN         5.5         NaN
3    mouse4       102.0       108.0         118         NaN         5.3         NaN
4    mouse5        98.0         NaN         112         5.1         5.4         NaN
        glucose_t0  glucose_t1  glucose_t2  insulin_t0  insulin_t1  insulin_t2
mouse1         0.0         0.0         0.0         0.0         1.0         0.0
mouse2         0.0         1.0         0.0         0.0         1.0         0.0
mouse3         1.0         0.0         0.0         1.0         0.0         1.0
mouse4         0.0         0.0         0.0         1.0         0.0         1.0
mouse5         0.0         1.0         0.0         0.0         0.0         1.0
Clusters: [0 1 0 0 1]
Silhouette score: 0.17776416479646978
</pre></div>
</div>
</div>
</div>
</section>
<section id="integration-w-ciss-vae-pipeline">
<h1>Integration w/ CISS-VAE pipeline<a class="headerlink" href="#integration-w-ciss-vae-pipeline" title="Link to this heading"></a></h1>
<p>The proportion matrix can be used directly in the complete CISS-VAE pipeline via the <code class="docutils literal notranslate"><span class="pre">missingness_proportion_matrix</span></code> parameter:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">ciss_vae.training.run_cissvae</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_cissvae</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ciss_vae.utils.helpers</span><span class="w"> </span><span class="kn">import</span> <span class="n">plot_vae_architecture</span>

<span class="n">prop_matrix</span> <span class="o">=</span> <span class="n">create_missingness_prop_matrix</span><span class="p">(</span>
    <span class="n">data_wide</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;sample_id&quot;</span>
<span class="p">)</span>

<span class="n">imputed_data</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">run_cissvae</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data_wide</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;sample_id&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="n">missingness_proportion_matrix</span><span class="o">=</span><span class="n">prop_matrix</span><span class="p">,</span>  <span class="c1"># Use custom matrix</span>
    <span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">scale_features</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Scale the proportion matrix features</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="mi">50</span>
<span class="p">)</span>

<span class="n">plot_vae_architecture</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[Warning] 3 feature(s) had zero std after masking. Replaced with 1.0 to avoid div-by-zero. Features: [&#39;glucose_t1&#39;, &#39;insulin_t1&#39;, &#39;insulin_t2&#39;]
Cluster dataset:
 ClusterDataset(n_samples=5, n_features=6, n_clusters=2)
  • Original missing: 10 / 30 (33.33%)
  • Validation held-out: 10 (50.00% of non-missing)
  • .data shape:     (5, 6)
  • .masks shape:    (5, 6)
  • .val_data shape: (5, 6)
</pre></div>
</div>
<img alt="_images/f6b7bbc2f2f4e5df3a1d1446bfbbac25ac4fe8a4d0ceaa4e2db66a6b6d55257e.png" src="_images/f6b7bbc2f2f4e5df3a1d1446bfbbac25ac4fe8a4d0ceaa4e2db66a6b6d55257e.png" />
</div>
</div>
</section>
<section id="full-workflow">
<h1>Full workflow<a class="headerlink" href="#full-workflow" title="Link to this heading"></a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ciss_vae.utils.matrix</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_missingness_prop_matrix</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ciss_vae.utils.clustering</span><span class="w"> </span><span class="kn">import</span> <span class="n">cluster_on_missing_prop</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ciss_vae.training.run_cissvae</span><span class="w"> </span><span class="kn">import</span> <span class="n">run_cissvae</span>

<span class="c1"># 1. Create longitudinal data with complex missingness patterns</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;patient_id&#39;</span><span class="p">:</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;P</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s1">03d</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">101</span><span class="p">)],</span>
    <span class="c1"># Glucose measurements - some patients miss early timepoints</span>
    <span class="s1">&#39;glucose_baseline&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">95</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="s1">&#39;glucose_month1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">92</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
    <span class="s1">&#39;glucose_month3&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
    <span class="s1">&#39;glucose_month6&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">88</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
    <span class="c1"># HbA1c - different missingness pattern</span>
    <span class="s1">&#39;hba1c_baseline&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">6.5</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
    <span class="s1">&#39;hba1c_month1&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.4</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">6.3</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
    <span class="s1">&#39;hba1c_month3&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.3</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">6.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
    <span class="s1">&#39;hba1c_month6&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mf">5.9</span><span class="p">,</span> <span class="mf">0.7</span><span class="p">,</span> <span class="mi">100</span><span class="p">)),</span>
<span class="p">})</span>

<span class="c1"># 2. Create missingness proportion matrix</span>
<span class="n">prop_matrix</span> <span class="o">=</span> <span class="n">create_missingness_prop_matrix</span><span class="p">(</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">index_col</span> <span class="o">=</span> <span class="s2">&quot;patient_id&quot;</span><span class="p">,</span>
    <span class="n">repeat_feature_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;glucose&quot;</span><span class="p">,</span> <span class="s2">&quot;hba1c&quot;</span><span class="p">],</span>
    <span class="n">nonint_timepoint</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missingness Proportion Matrix: </span><span class="se">\n</span><span class="si">{</span><span class="n">prop_matrix</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># 3. Run complete CISS-VAE pipeline</span>
<span class="n">main_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s1">&#39;patient_id&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="n">imputed_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">history</span> <span class="o">=</span> <span class="n">run_cissvae</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">main_data</span><span class="p">,</span>
    <span class="n">missingness_proportion_matrix</span><span class="o">=</span><span class="n">prop_matrix</span><span class="p">,</span>
    <span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">scale_features</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">epochs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">return_history</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Original Data: </span><span class="se">\n</span><span class="si">{</span><span class="n">main_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2"> </span><span class="se">\n\n</span><span class="s2">Imputed Data:</span><span class="se">\n</span><span class="si">{</span><span class="n">imputed_data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Missingness Proportion Matrix: 
      glucose  hba1c
P001     0.25   0.25
P002     0.50   0.25
P003     0.50   0.25
P004     0.00   0.50
P005     0.00   0.25
Cluster dataset:
 ClusterDataset(n_samples=100, n_features=8, n_clusters=2)
  • Original missing: 169 / 800 (21.12%)
  • Validation held-out: 56 (8.87% of non-missing)
  • .data shape:     (100, 8)
  • .masks shape:    (100, 8)
  • .val_data shape: (100, 8)

Original Data: 
   glucose_baseline  glucose_month1  glucose_month3  glucose_month6  hba1c_baseline  hba1c_month1  hba1c_month3  hba1c_month6
0         99.967142       92.156023             NaN       87.339202             NaN      5.859505      6.079557      5.634611
1         93.617357             NaN       78.972177             NaN        6.819309      7.239745           NaN      5.757494
2        101.476885             NaN             NaN       81.481639        6.469892           NaN      6.534880      5.492823
3        110.230299      124.642030       86.824755       88.473987             NaN      7.962037           NaN      5.189670
4         92.658466       99.508008       93.549904       79.395866        6.591382      6.825535           NaN      5.445506 

Imputed Data:
   glucose_baseline  glucose_month1  glucose_month3  glucose_month6  hba1c_baseline  hba1c_month1  hba1c_month3  hba1c_month6
0         99.967140       92.156021       91.040680       87.339203        6.638026      5.859505      6.079557      5.634611
1         93.617355       93.880074       78.972176       92.288696        6.819309      7.239745      6.510371      5.757494
2        101.476883       94.809273       97.503601       81.481636        6.469892      6.370516      6.534880      5.492823
3        110.230301      124.642029       86.824753       88.473984        5.975946      7.962037      7.977868      5.189670
4         92.658463       99.508011       93.549904       79.395866        6.591382      6.825535      5.856393      5.445506
</pre></div>
</div>
</div>
</div>
<section id="extra-tips">
<h2>Extra tips<a class="headerlink" href="#extra-tips" title="Link to this heading"></a></h2>
<ol class="arabic simple">
<li><p><strong>Sample Clustering</strong>: <code class="docutils literal notranslate"><span class="pre">cluster_on_missing_prop</span></code> clusters <strong>samples (rows)</strong> based on their missingness profiles across features. This groups subjects with similar patterns of missing data.</p></li>
<li><p><strong>Data format</strong>: Provide the input as a matrix or DataFrame with <strong>rows = samples</strong> and <strong>columns = features</strong>. The data must be in <strong>wide</strong> format.</p></li>
<li><p><strong>Scaling</strong>: Use <code class="docutils literal notranslate"><span class="pre">scale_features=True</span></code> if features differ greatly in their overall missingness rates. This standardizes the columns so no single feature dominates the clustering.</p></li>
</ol>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="binary_vignette.html" class="btn btn-neutral float-left" title="Handling binary data columns" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="dni_vignette.html" class="btn btn-neutral float-right" title="Avoiding undesired imputation of certain missing data" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Yasin Khadem Charvadeh, Danielle Vaithilingam, Kenneth Seier, Katherine S. Panageas, Mithat Gönen, Yuan Chen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>